<!DOCTYPE html>
<html>
<head>
    <title>Virtual Coordinate System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .viewport {
            border: 2px solid #444;
            background: #2a2a2a;
            border-radius: 5px;
            padding: 10px;
        }
        .canvas {
            border: 1px solid #666;
            background: #333;
            display: block;
            margin: 10px 0;
        }
        .info {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background: #45a049;
        }
        .player {
            position: absolute;
            border: 2px solid #fff;
            color: #fff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Virtual Coordinate System Test</h1>
    
    <div class="controls">
        <button onclick="addPlayer()">Add Player</button>
        <button onclick="removePlayer()">Remove Player</button>
        <button onclick="resetTest()">Reset</button>
    </div>

    <div class="info">
        <h3>Virtual Coordinate System</h3>
        <p><strong>Concept:</strong> All clients use the same logical coordinate system (1200×800) regardless of screen size.</p>
        <p><strong>Benefit:</strong> Players appear at the same relative positions on all devices.</p>
        <p><strong>Implementation:</strong> Server coordinates → Virtual coordinates → Canvas coordinates</p>
    </div>

    <div class="container" id="viewportContainer"></div>

    <script>
        const VIRTUAL_WIDTH = 1200;
        const VIRTUAL_HEIGHT = 800;
        const PLAYER_COLORS = ['#FF5252', '#FF9800', '#FFEB3B', '#4CAF50', '#00BCD4', '#E91E63', '#3F51B5'];
        
        let players = [];
        let viewports = [];

        // Simulate different device sizes
        const deviceSizes = [
            { name: 'Mobile Portrait', width: 375, height: 667 },
            { name: 'Mobile Landscape', width: 667, height: 375 },
            { name: 'Tablet', width: 768, height: 1024 },
            { name: 'Desktop', width: 1200, height: 800 },
            { name: 'Large Desktop', width: 1920, height: 1080 }
        ];

        class VirtualViewport {
            constructor(name, width, height) {
                this.name = name;
                this.width = width;
                this.height = height;
                this.canvas = null;
                this.ctx = null;
                this.scaleX = width / VIRTUAL_WIDTH;
                this.scaleY = height / VIRTUAL_HEIGHT;
                
                this.createElement();
            }

            createElement() {
                const viewportDiv = document.createElement('div');
                viewportDiv.className = 'viewport';
                viewportDiv.innerHTML = `
                    <h3>${this.name} (${this.width}×${this.height})</h3>
                    <canvas class="canvas" width="${this.width}" height="${this.height}"></canvas>
                    <div class="info">
                        <div>Canvas: ${this.width} × ${this.height}</div>
                        <div>Virtual: ${VIRTUAL_WIDTH} × ${VIRTUAL_HEIGHT}</div>
                        <div>Scale: ${this.scaleX.toFixed(3)} × ${this.scaleY.toFixed(3)}</div>
                    </div>
                `;
                
                document.getElementById('viewportContainer').appendChild(viewportDiv);
                
                this.canvas = viewportDiv.querySelector('canvas');
                this.ctx = this.canvas.getContext('2d');
            }

            virtualToCanvas(virtualX, virtualY) {
                return {
                    x: (virtualX / VIRTUAL_WIDTH) * this.width,
                    y: (virtualY / VIRTUAL_HEIGHT) * this.height
                };
            }

            virtualSizeToCanvas(virtualWidth, virtualHeight) {
                return {
                    width: (virtualWidth / VIRTUAL_WIDTH) * this.width,
                    height: (virtualHeight / VIRTUAL_HEIGHT) * this.height
                };
            }

            render() {
                // Clear canvas
                this.ctx.fillStyle = '#1a1a1a';
                this.ctx.fillRect(0, 0, this.width, this.height);

                // Draw grid
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                this.ctx.lineWidth = 1;
                
                // Vertical lines every 100 virtual units
                for (let x = 0; x <= VIRTUAL_WIDTH; x += 100) {
                    const canvasX = this.virtualToCanvas(x, 0).x;
                    this.ctx.beginPath();
                    this.ctx.moveTo(canvasX, 0);
                    this.ctx.lineTo(canvasX, this.height);
                    this.ctx.stroke();
                }
                
                // Horizontal lines every 100 virtual units
                for (let y = 0; y <= VIRTUAL_HEIGHT; y += 100) {
                    const canvasY = this.virtualToCanvas(0, y).y;
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, canvasY);
                    this.ctx.lineTo(this.width, canvasY);
                    this.ctx.stroke();
                }

                // Draw border
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                this.ctx.lineWidth = 2;
                this.ctx.strokeRect(0, 0, this.width, this.height);

                // Draw players
                players.forEach((player, index) => {
                    const pos = this.virtualToCanvas(player.x, player.y);
                    const size = this.virtualSizeToCanvas(player.width, player.height);

                    this.ctx.fillStyle = player.color;
                    this.ctx.fillRect(pos.x, pos.y, size.width, size.height);

                    this.ctx.strokeStyle = '#ffffff';
                    this.ctx.lineWidth = 1;
                    this.ctx.strokeRect(pos.x, pos.y, size.width, size.height);

                    // Draw player number
                    this.ctx.fillStyle = '#ffffff';
                    this.ctx.font = `${Math.max(10, size.width * 0.3)}px Arial`;
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(
                        (index + 1).toString(),
                        pos.x + size.width / 2,
                        pos.y + size.height / 2 + 4
                    );
                });

                // Draw coordinate info
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                this.ctx.fillRect(5, 5, 180, 60);
                this.ctx.fillStyle = '#ffffff';
                this.ctx.font = '12px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText(`Virtual: ${VIRTUAL_WIDTH}×${VIRTUAL_HEIGHT}`, 10, 20);
                this.ctx.fillText(`Canvas: ${this.width}×${this.height}`, 10, 35);
                this.ctx.fillText(`Scale: ${this.scaleX.toFixed(3)}×${this.scaleY.toFixed(3)}`, 10, 50);
            }
        }

        function initializeViewports() {
            viewports = deviceSizes.map(device => 
                new VirtualViewport(device.name, device.width, device.height)
            );
            renderAll();
        }

        function addPlayer() {
            const index = players.length;
            const color = PLAYER_COLORS[index % PLAYER_COLORS.length];
            
            // Spawn players in different virtual positions
            const spawnPositions = [
                { x: 300, y: 700 },   // Bottom left
                { x: 600, y: 100 },   // Top center
                { x: 900, y: 700 },   // Bottom right
                { x: 150, y: 400 },   // Left center
                { x: 1050, y: 400 },  // Right center
                { x: 600, y: 400 },   // Center
                { x: 450, y: 250 },   // Top left of center
                { x: 750, y: 550 }    // Bottom right of center
            ];
            
            const spawnPos = spawnPositions[index % spawnPositions.length];
            
            const player = {
                x: spawnPos.x,
                y: spawnPos.y,
                width: 60,
                height: 60,
                color: color
            };
            
            players.push(player);
            renderAll();
        }

        function removePlayer() {
            if (players.length > 0) {
                players.pop();
                renderAll();
            }
        }

        function resetTest() {
            players = [];
            renderAll();
        }

        function renderAll() {
            viewports.forEach(viewport => viewport.render());
        }

        // Animation loop to show movement
        function animatePlayer() {
            if (players.length > 0) {
                // Move first player in a circle
                const time = Date.now() * 0.001;
                const centerX = 600;
                const centerY = 400;
                const radius = 200;
                
                players[0].x = centerX + Math.cos(time) * radius;
                players[0].y = centerY + Math.sin(time) * radius;
                
                renderAll();
            }
            requestAnimationFrame(animatePlayer);
        }

        // Initialize on load
        initializeViewports();
        
        // Add some initial players
        setTimeout(() => {
            addPlayer();
            addPlayer();
            addPlayer();
        }, 500);

        // Start animation
        animatePlayer();
    </script>
</body>
</html>