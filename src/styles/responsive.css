/* ============================================
   FLUID RESPONSIVE - No Breakpoints, Pure Fluid Scaling
   ============================================ */

/* CSS Custom Properties updated by FluidResponsiveSystem */
:root {
    /* Core fluid properties - updated in real-time */
    --fluid-scale: 1;
    --canvas-width: 600px;
    --canvas-height: 700px;
    --viewport-width: 100vw;
    --viewport-height: 100vh;
    --device-pixel-ratio: 1;
    --aspect-ratio: 1;
    
    /* Neural net ready properties */
    --responsive-score: 1;
    --adaptation-level: 0;
    --diagonal-inches: 5;
    
    /* Mobile viewport fixes */
    --vh: 1vh; /* Real viewport height for mobile browsers */
    --ctrl-h: 120px; /* Control panel height */
}

/* Device-specific classes (no breakpoints) - Applied by FluidResponsiveSystem */
.touch-device .app-root {
    height: calc(var(--vh, 1vh) * 100);
    max-height: calc(var(--vh, 1vh) * 100);
}

/* Fluid header - scales with viewport */
.app-header {
    padding: calc(var(--fluid-scale) * var(--space-md)) calc(var(--fluid-scale) * var(--space-lg));
    padding-top: max(calc(var(--fluid-scale) * var(--space-lg)), env(safe-area-inset-top, 8px));
    min-height: calc(40px + var(--fluid-scale) * 20px); /* Scales from 40px to 60px */
}

.app-header h1 {
    font-size: calc(1.2rem + var(--fluid-scale) * 0.3rem); /* Scales from 1.2rem to 1.5rem */
    margin: 0 0 calc(var(--fluid-scale) * var(--space-xs)) 0;
}

/* Score panel scales with screen size and responsiveness score */
.score-panel {
    gap: calc(var(--space-xs) + var(--fluid-scale) * var(--space-xs));
    padding: calc(var(--fluid-scale) * var(--space-xs)) 0;
    opacity: calc(0.7 + var(--responsive-score) * 0.3); /* More visible when responsive score is high */
}

.score-panel h4 {
    font-size: calc(0.6rem + var(--fluid-scale) * 0.1rem);
    opacity: calc(0.6 + var(--responsive-score) * 0.2);
    letter-spacing: 0.025em;
}

/* Game area uses fluid scaling */
.game-main {
    padding: calc(var(--space-sm) + var(--fluid-scale) * var(--space-md));
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.game-area {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0;
}

/* Canvas viewport - completely fluid, no breakpoints */
.canvas-viewport {
    width: 100%;
    height: 100%;
    max-width: calc(var(--viewport-width) - var(--space-xl) * 2);
    max-height: calc(var(--vh, 1vh) * 100 - var(--ctrl-h, 120px) - 6rem);
    min-width: calc(200px + var(--fluid-scale) * 80px); /* Scales minimum size */
    min-height: calc(150px + var(--fluid-scale) * 50px);
    flex: 1;
    margin: calc(var(--space-md) + var(--fluid-scale) * var(--space-lg));
    border-radius: calc(var(--border-radius) * var(--fluid-scale));
    box-shadow: 0 calc(var(--space-xs) * var(--fluid-scale)) calc(var(--space-lg) * var(--fluid-scale)) rgba(0, 0, 0, 0.3);
}

/* Canvas scales perfectly with FluidResponsiveSystem */
.game-canvas {
    width: var(--canvas-width);
    height: var(--canvas-height);
    max-width: 100%;
    max-height: 100%;
    transition: width 0.15s ease, height 0.15s ease;
}
    
/* Touch device control panel - fluid scaling */
.touch-device .control-panel {
    flex: 0 0 auto;
    max-height: calc(20vh + var(--fluid-scale) * 5vh); /* Scales from 20vh to 25vh */
    padding: calc(var(--space-md) * var(--fluid-scale)) calc(var(--space-lg) * var(--fluid-scale));
    padding-bottom: calc(env(safe-area-inset-bottom, 0) + var(--space-md) * var(--fluid-scale));
    position: relative;
    z-index: var(--z-ui);
    background: linear-gradient(to top, rgba(10, 25, 47, calc(0.8 + var(--responsive-score) * 0.1)), transparent);
    margin-top: calc(var(--space-sm) * var(--fluid-scale));
}

/* Touch controller - completely fluid sizing */
.touch-device .touch-controller {
    display: flex !important;
    justify-content: space-between;
    align-items: center;
    height: auto;
    min-height: calc(60px + var(--fluid-scale) * 40px + var(--diagonal-inches) * 5px); /* Scales with screen size AND device */
    padding: calc(var(--space-md) * var(--fluid-scale)) calc(var(--space-lg) * var(--fluid-scale));
    gap: calc(var(--space-lg) * var(--fluid-scale));
    opacity: calc(0.8 + var(--responsive-score) * 0.2); /* More opaque when responsive score is high */
}
    
/* Device visibility classes - applied by FluidResponsiveSystem */
.touch-device .info-panel {
    display: none;
}

.touch-device .desktop-only {
    display: none;
}

.touch-device .mobile-only {
    display: block;
}

.mouse-device .mobile-only {
    display: none;
}

.mouse-device .desktop-only {
    display: block;
}

/* Small screen adaptations - high adaptation level indicates smaller screens */
.screen-phone .game-main {
    padding: calc(var(--space-xs) * var(--fluid-scale));
}

.screen-phone .game-canvas {
    border-width: calc(1px * var(--fluid-scale)) !important;
    transition: width 0.15s ease, height 0.15s ease;
}

.screen-phone .app-header {
    padding: calc(var(--space-sm) * var(--fluid-scale));
    padding-top: max(calc(var(--space-sm) * var(--fluid-scale)), env(safe-area-inset-top, 8px));
    min-height: calc(3rem + var(--fluid-scale) * 0.5rem);
}

.screen-phone .control-panel {
    padding: calc(var(--space-xs) * var(--fluid-scale));
    max-height: calc(var(--vh, 1vh) * 100 - 150px - var(--adaptation-level) * 50px);
}

/* Touch controls scale with device characteristics */
.screen-phone .touch-controls {
    max-width: calc(90vw + var(--fluid-scale) * 5vw);
    gap: calc(var(--space-xs) + var(--fluid-scale) * var(--space-sm));
}

.screen-phone .dpad-container {
    width: calc(80px + var(--diagonal-inches) * 4px + var(--fluid-scale) * 20px);
    height: calc(80px + var(--diagonal-inches) * 4px + var(--fluid-scale) * 20px);
}

.screen-phone .action-btn {
    width: calc(var(--touch-min, 44px) + var(--fluid-scale) * 6px);
    height: calc(var(--touch-min, 44px) + var(--fluid-scale) * 6px);
    font-size: calc(10px + var(--fluid-scale) * 6px);
}

/* Extremely constrained screens - high adaptation level + small diagonal */
.landscape[style*="--adaptation-level"][style*="--diagonal-inches"] .app-header h1 {
    font-size: calc(1rem + var(--fluid-scale) * 0.25rem);
    margin: 0 0 calc(var(--fluid-scale) * var(--space-xs)) 0;
}

/* Hide score panel when space is very constrained */
.portrait[style*="--adaptation-level: 0.7"], 
.portrait[style*="--adaptation-level: 0.8"],
.portrait[style*="--adaptation-level: 0.9"] {
    .score-panel {
        display: none;
    }
}

/* Desktop layout - applied by screen-desktop class */
.screen-desktop .app-root {
    height: 100vh;
    width: 100vw;
    max-width: none;
}

.screen-desktop .control-panel,
.screen-desktop .float-menu {
    display: none;
}

.screen-desktop .touch-controller {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    left: -9999px !important;
}

.screen-desktop .game-area {
    display: grid;
    grid-template-columns: 1fr calc(200px + var(--fluid-scale) * 80px);
    gap: calc(var(--space-lg) * var(--fluid-scale));
    height: 100%;
}

/* TV/Large display optimizations */
.screen-tv .game-area {
    grid-template-columns: 1fr calc(300px + var(--fluid-scale) * 100px);
    gap: calc(var(--space-xl) * var(--fluid-scale));
}

/* Browser-specific fixes - applied by FluidResponsiveSystem */
.chrome-mobile .app-root {
    height: calc(var(--vh, 1vh) * 100) !important;
}

.chrome-mobile .control-panel {
    min-height: calc(var(--ctrl-h, 100px) * var(--fluid-scale)) !important;
    padding-bottom: calc(var(--space-lg) * var(--fluid-scale)) !important;
}

.chrome-mobile .game-canvas {
    max-height: calc(var(--vh, 1vh) * 100 - var(--ctrl-h, 120px) - 3rem) !important;
    width: var(--canvas-width) !important;
    height: var(--canvas-height) !important;
}

/* Tablet-specific optimizations */
.screen-tablet .game-canvas {
    max-width: calc(var(--viewport-width) - calc(var(--space-lg) * 2));
    max-height: calc(var(--vh, 1vh) * 100 - var(--ctrl-h, 120px) - 4rem);
}

/* Landscape optimizations for touch devices */
.touch-device.landscape .app-header {
    padding: calc(var(--space-sm) * var(--fluid-scale)) calc(var(--space-md) * var(--fluid-scale));
    min-height: calc(40px + var(--fluid-scale) * 10px);
}

.touch-device.landscape .control-panel {
    padding: calc(var(--space-xs) * var(--fluid-scale)) calc(var(--space-sm) * var(--fluid-scale));
    max-height: calc(15vh + var(--fluid-scale) * 5vh);
}

.touch-device.landscape .touch-controller {
    min-height: calc(40px + var(--diagonal-inches) * 8px + var(--fluid-scale) * 20px);
}

.touch-device.landscape .game-canvas {
    max-width: calc(var(--viewport-width) - 1rem);
    max-height: calc(var(--vh, 1vh) * 100 - 6rem);
}

/* ============================================
   LOADING & ERROR STATES
   ============================================ */
.loader {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    border: 4px solid var(--side-panel-accent);
    border-top: 4px solid var(--accent-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 10000;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

.error-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--primary-light);
    border: 2px solid var(--warning);
    border-radius: var(--border-radius);
    padding: var(--space-lg);
    text-align: center;
    z-index: 10000;
    display: none;
    max-width: 400px;
    width: 90%;
}

.error-panel h3 {
    color: var(--warning);
    margin-bottom: var(--space-md);
}

.error-panel button {
    margin-top: var(--space-md);
    padding: var(--space-sm) var(--space-lg);
    background: var(--accent-primary);
    color: var(--text-dark);
    border: none;
    border-radius: var(--border-radius);
    font-weight: bold;
    cursor: pointer;
    transition: all var(--transition);
}

.error-panel button:hover {
    background: var(--accent-secondary);
}

/* ============================================
   ORIENTATION OVERLAY
   ============================================ */
.orientation-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--primary-dark);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10001;
    text-align: center;
    padding: var(--space-lg);
}

.orientation-overlay img {
    width: 80px;
    height: 80px;
    margin-bottom: var(--space-lg);
    animation: pulse 2s infinite;
}

.orientation-overlay h3 {
    color: var(--accent-secondary);
    margin-bottom: var(--space-md);
    font-size: 1.5rem;
}

.orientation-overlay p {
    color: var(--text-light);
    max-width: 300px;
    line-height: 1.6;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Show orientation overlay on portrait mobile */
/* @media (max-width: 768px) and (orientation: portrait) {
    .orientation-overlay {
        display: flex;
    }
    
    .app-root {
        display: none;
    }
} */
 @media (max-width: 768px) and (orientation: portrait) {
    .orientation-overlay {
        display: none;  /* Changed from flex - hide the "rotate" message */
    }
    
    /* DELETE the .app-root rule entirely - let the game show */
}

/* ============================================
   ACCESSIBILITY & REDUCED MOTION
   ============================================ */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .game-canvas {
        border-width: 3px;
    }
    
    .btn-action,
    .nav-button {
        border: 2px solid currentColor;
    }
}
